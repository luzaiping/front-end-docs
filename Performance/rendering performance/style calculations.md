# 缩小样式计算的范围并降低其复杂性

通过添加和删除元素，更改属性、类或通过动画来更改 DOM，全都会导致浏览器重新计算元素样式，在很多情况下还会对页面或页面的一部分进行布局（即自动重排）。这就是所谓的计算样式的计算(computed style calculation)

计算样式的第一部分是创建一组匹配选择器，这实质上是浏览器计算出给指定元素应用哪些类、伪选择器和 ID

第二部分涉及从匹配选择器中获取所有样式规则，并计算出此元素的最终样式。

这两部分占用的时间差不多是各一半

+ 降低选择器的复杂性；使用以类为中心的方法，例如 BEM。
+ 减少必须计算其样式的元素数量。

## 降低选择器的复杂性

在最简单的情况下，您在 CSS 中引用只有一个类的元素：
```css
.title {
  /* styles */
}
```

而不是下面这种：

```javascript
.box:nth-last-child(-n+1) .title {
  /* styles */
}
```
这种情形，浏览器实际上必须询问“这是否为有 title 类的元素，其父元素恰好是负第 N 个子元素加上 1 个带 box 类的元素？”计算此结果可能需要大量时间。

## 减少要计算样式的元素数量

另一个性能考虑，对于_许多样式更新而言是更重要的因素_，即减少在元素更改时需要计算的工作量。

总体来说，计算元素的计算样式的最糟糕的开销情况是元素数量乘以选择器数量，因为需要对照每个样式对每个元素都检查至少一次，看它是否匹配。

## 测量样式重新计算的开销

测量样式重新计算的最简单、最好的方法是使用 Chrome DevTools 的 Timeline 模式。首先，打开 DevTools，转至 Timeline 选项卡，选中记录并与您的网站交互

## 使用块、元素、修饰符

BEM（块、元素、修饰符）之类的编码方法实际上纳入了上述选择器匹配的性能优势，因为它建议所有元素都有单个类，并且在需要层次结构时也纳入了类的名称：
```css
.list { }
.list__list-item { }
```
如果需要一些修饰符，像在上面我们想为最后一个子元素做一些特别的东西，就可以按如下方式添加：
```css
.list__list-item--last-child {}
```