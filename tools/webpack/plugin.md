# plugin

这边包含两部分内容： 手写 plugin 和 常见 plugins

## 手写 plugin

### compiler 和 compilcation

compiler object 代表完整的可配置webpack 环境。创建一个 plugin 时会接收一个 compiler 参数，通过该参数可以主要的 webpack 环境信息。

compilation object 代表单次 build 时的 versioned assets (特定版本的assets)，这个是 plugin 的核心所在

实现一个 plugin 通常是监听这2个对象暴露出来的事件

### plugin 基本结构

Plugin 是一个构造函数，在构造函数的 prototype 上定义一个 apply 方法，该方法接收一个 compiler 对象

```javascript
function HelloPlugin(options) {

}

HelloPlugin.prototype.apply = function(compiler) {
  compiler.plugin('done', function() {
    console.log('hello world!')
  })
}
```

这个例子在 webpack build 完成后，执行 console.log. 

```javascript
function MyPlugin(options) {

}

MyPlugin.prototype.apply = function(compiler) {
  compiler.plugin('emit', function(compilation, callback) {

    // Explore each chunk (build output):
    compilation.chunks.forEach(function(chunk) {
       // Explore each module within the chunk (built inputs):
      chunk.forEachModule(function(module) {
        // Explore each source file path that was included into the module:
        module.fileDependencies.forEach(function(filePath) {
          // we've learned a lot about the source structure now...
        })
      });

      // Explore each asset filename generated by the chunk:
      chunk.files.forEach(function(filename) {
        // Get the asset source for each file generated by the chunk:
        var source = compilation.assets[filename].source();
      })
    });

  })
}

module.exports = MyPlugin;
```
写好一个 Plugin 后， 在 webpack 的 plugins 通过  new MyPlugin(options) 实例化