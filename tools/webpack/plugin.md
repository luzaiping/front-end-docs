# plugin

这边包含两部分内容： 手写 plugin 和 常见 plugins

## 手写 plugin

### compiler 和 compilcation

plugins expose the full potential of webpack engine to third-party developers. Using staged build callbacks, developer can introduce their own behaviors into the webpack build process.

compiler object 代表完整的可配置webpack 环境。一旦webpack启动，这个对象就会被创建。当创建一个 plugin 时会接收一个 compiler 参数，通过该参数可以得到主要的 webpack 环境信息。

compilation object 代表单次 versioned assets (特定版本的assets) build ；每次当有文件修改被检测到，一个新的 compilation 会被创建，然后生成一组新的 compiled assets。

A compilation 暴露关于 module resources, compiled assets, change files, watched dependencies 的当前状态信息。 Compilation 提供了很多 callback, 允许 plugin 在特定时候执行特定的action

实现一个 plugin, 分为2个步骤：
1. 定义一个 Plugin name 的构造函数, 接收一个 options 参数
1. 在构造函数的prototype上定义一个 apply 函数，接收一个 compiler 参数

apply 函数是 plugin 的重点，通常在函数体内监听这上面2个核心对象暴露出来的事件。当安装plugin的时候，webpack compiler 就会执行 apply 方法。

### plugin 基本结构

Plugin 是一个构造函数，在构造函数的 prototype 上定义一个 apply 方法，该方法接收一个 compiler 对象

```javascript
function HelloPlugin(options) {

}

HelloPlugin.prototype.apply = function(compiler) {
  compiler.plugin('done', function() {
    console.log('hello world!')
  })
}
```

这个例子在 webpack build 完成后，执行 console.log. 

```javascript
function MyPlugin(options) {

}

MyPlugin.prototype.apply = function(compiler) {
  compiler.plugin('emit', function(compilation, callback) {

    // Explore each chunk (build output):
    compilation.chunks.forEach(function(chunk) {
       // Explore each module within the chunk (built inputs):
      chunk.forEachModule(function(module) {
        // Explore each source file path that was included into the module:
        module.fileDependencies.forEach(function(filePath) {
          // we've learned a lot about the source structure now...
        })
      });

      // Explore each asset filename generated by the chunk:
      chunk.files.forEach(function(filename) {
        // Get the asset source for each file generated by the chunk:
        var source = compilation.assets[filename].source();
      })
    });

  })
}

module.exports = MyPlugin;
```
写好一个 Plugin 后， 在 webpack 的 plugins 通过  new MyPlugin(options) 实例化